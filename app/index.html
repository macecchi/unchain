<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css">
<script type="application/javascript" src="../index.js"></script>
<script>
    onload = function() {
        var window = nw.Window.get();
        
        setTimeout(loadPin, 1000);
        
        window.on('close', function() {
            savePassword();
            window.hide();
        });
        
        document.getElementById('password-form').onsubmit = function() {
            savePassword();
            return false;
        };
        
        function loadPin() {
            UnchainSecurity.getPin(function(err, pin) {
                if (err) {
                    console.log('Error loading PIN');
                    return;
                }
                var pinCode = document.getElementById('pin-code');
                pinCode.innerHTML = pin;
            });
        }
    
        function savePassword() {
            var passwordField = document.getElementById('password');
            var newPassword = passwordField.value;
            
            if (newPassword) {
                UnchainSecurity.setPassword(newPassword, function() {
                    didSetPassword();
                });
                passwordField.value = '';
            }
        }
    }
</script>
</head>
<body>
    <div class="row">
        <label for="pin-code">PIN:</label>
        <span id="pin-code" class="pin">----</span>
    </div>
    
    <div class="row">
        <form id="password-form">
        <label for="password">Password:</label>
        <input type="password" name="password" id="password">
        </form>
    </div>

</body>
</html>